<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /docs/mdsource/filters.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Filters

Sometimes, in the context of constructing an EF query, it is not possible to know if any given item should be returned in the results. For example when performing authorization where the rules rules are pulled from a different system, and that information does not exist in the database.

`Filters` allows a custom function to be executed after the EF query execution and determine if any given node should be included in the result.

Notes:

 * When evaluated on nodes of a collection, excluded nodes will be removed from collection.
 * When evaluated on a property node, the value will be replaced with null.
 * When doing paging or counts, there is currently no smarts that adjust counts or pages sizes when items are excluded. If this is required submit a PR that adds this feature, or don't mix filters with paging.
 * The filter is passed the current [User Context](https://graphql-dotnet.github.io/docs/getting-started/user-context) and the node item instance.
 * Filters will not be executed on null item instance.
 * A [Type.IsAssignableFrom](https://docs.microsoft.com/en-us/dotnet/api/system.type.isassignablefrom) check will be performed to determine if an item instance should be filtered based on the `<TItem>`.


### Signature:

<!-- snippet: FiltersSignature -->
<a id='snippet-filterssignature'></a>
```cs
public class Filters
{
    public delegate bool Filter<in TEntity>(object userContext, ClaimsPrincipal? userPrincipal, TEntity input)
        where TEntity : class;

    public delegate Task<bool> AsyncFilter<in TEntity>(object userContext, ClaimsPrincipal? userPrincipal, TEntity input)
        where TEntity : class;
```
<sup><a href='/src/GraphQL.EntityFramework/Filters/Filters.cs#L5-L15' title='Snippet source file'>snippet source</a> | <a href='#snippet-filterssignature' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Usage:

<!-- snippet: add-filter -->
<a id='snippet-add-filter'></a>
```cs
public class MyEntity
{
    public string? Property { get; set; }
}
```
<sup><a href='/src/Snippets/GlobalFilterSnippets.cs#L8-L15' title='Snippet source file'>snippet source</a> | <a href='#snippet-add-filter' title='Start of snippet'>anchor</a></sup>
<a id='snippet-add-filter-1'></a>
```cs
var filters = new Filters();
filters.Add<MyEntity>(
    (userContext, userPrincipal, item) => item.Property != "Ignore");
EfGraphQLConventions.RegisterInContainer<MyDbContext>(
    services,
    resolveFilters: x => filters);
```
<sup><a href='/src/Snippets/GlobalFilterSnippets.cs#L19-L28' title='Snippet source file'>snippet source</a> | <a href='#snippet-add-filter-1' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->
